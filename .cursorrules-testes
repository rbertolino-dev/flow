# ğŸ§ª Regras para Testes AutomÃ¡ticos E2E

## ğŸ¯ Regra Principal: Entender Contexto e Testar Automaticamente

**SEMPRE** entender o contexto da tarefa e executar testes E2E automatizados quando:
- Implementar nova funcionalidade
- Corrigir bug
- Fazer mudanÃ§as em funcionalidades crÃ­ticas
- Antes de fazer deploy
- Quando usuÃ¡rio pedir para testar

**O Cursor DEVE** executar testes automaticamente baseado no contexto, sem pedir confirmaÃ§Ã£o.

### Fluxo ObrigatÃ³rio:

1. **PRIMEIRO**: Executar testes automatizados
2. **SEGUNDO**: Analisar erros capturados
3. **TERCEIRO**: Aplicar correÃ§Ãµes sugeridas
4. **QUARTO**: Re-executar testes para validar

---

## ğŸš€ Executar Testes AutomÃ¡ticos

### Comando Principal:

```bash
# Executar todos os testes e capturar erros
npm run test:e2e:auto

# Executar com anÃ¡lise de erros
npm run test:e2e:analyze

# Executar e gerar relatÃ³rio de correÃ§Ãµes
npm run test:e2e:fix-suggestions
```

### Quando Executar:

- âœ… Antes de fazer deploy
- âœ… ApÃ³s mudanÃ§as em funcionalidades crÃ­ticas
- âœ… ApÃ³s adicionar novas features
- âœ… ApÃ³s correÃ§Ãµes de bugs
- âœ… Periodicamente (CI/CD)

---

## ğŸ“Š Captura e AnÃ¡lise de Erros

### O Que Ã‰ Capturado:

1. **Screenshots** de falhas
2. **VÃ­deos** das execuÃ§Ãµes que falharam
3. **Logs** detalhados de erros
4. **Stack traces** completos
5. **Seletores** que falharam
6. **Tempo de resposta** de elementos

### AnÃ¡lise AutomÃ¡tica:

Os testes automaticamente:
- âœ… Identificam padrÃµes de erro
- âœ… Sugerem correÃ§Ãµes baseadas em erros comuns
- âœ… Geram relatÃ³rio de problemas encontrados
- âœ… Priorizam erros por criticidade

---

## ğŸ”§ CorreÃ§Ãµes AutomÃ¡ticas Sugeridas

### Tipos de CorreÃ§Ãµes:

1. **Seletores quebrados:**
   - SugestÃ£o: Atualizar seletores
   - AÃ§Ã£o: Script gera novos seletores baseados na estrutura atual

2. **Timeouts:**
   - SugestÃ£o: Aumentar timeout ou otimizar performance
   - AÃ§Ã£o: Ajustar timeouts no playwright.config.ts

3. **Elementos nÃ£o encontrados:**
   - SugestÃ£o: Verificar se elemento existe ou se mudou
   - AÃ§Ã£o: Atualizar seletores ou adicionar waits

4. **ValidaÃ§Ãµes falhando:**
   - SugestÃ£o: Ajustar validaÃ§Ãµes ou dados de teste
   - AÃ§Ã£o: Atualizar helpers de teste

---

## ğŸ“ PadrÃµes de Teste

### Estrutura de Teste:

```typescript
test('nome do teste', async ({ authenticatedPage }) => {
  // 1. Navegar
  await navigateTo(authenticatedPage, '/');
  
  // 2. Interagir
  await createLead(authenticatedPage, { name: 'Teste' });
  
  // 3. Validar
  expect(await leadExists(authenticatedPage, 'Teste')).toBe(true);
});
```

### Tratamento de Erros:

```typescript
test('teste com captura de erro', async ({ authenticatedPage }) => {
  try {
    await createLead(authenticatedPage, { name: 'Teste' });
  } catch (error) {
    // Erro Ã© automaticamente capturado e analisado
    // Screenshot e vÃ­deo sÃ£o salvos
    throw error; // Re-lanÃ§a para o Playwright processar
  }
});
```

---

## ğŸ”„ Fluxo de CorreÃ§Ã£o AutomÃ¡tica

```
Teste falha
    â†“
Erro capturado (screenshot, vÃ­deo, logs)
    â†“
AnÃ¡lise automÃ¡tica do erro
    â†“
SugestÃµes de correÃ§Ã£o geradas
    â†“
RelatÃ³rio criado (test-results/fix-suggestions.json)
    â†“
Desenvolvedor revisa e aplica correÃ§Ãµes
    â†“
Re-executa testes
    â†“
âœ… Testes passam
```

---

## ğŸ“‹ Checklist de Testes

Antes de fazer deploy:

- [ ] Executar testes: `npm run test:e2e:auto`
- [ ] Revisar erros capturados
- [ ] Aplicar correÃ§Ãµes sugeridas
- [ ] Re-executar testes
- [ ] Verificar que todos passam
- [ ] Fazer deploy

---

## ğŸ¯ Prioridades de Teste

### Alta Prioridade (Sempre Testar):

- Login/AutenticaÃ§Ã£o
- CRUD de Leads
- CRUD de OrganizaÃ§Ãµes
- Fluxos de pagamento
- IntegraÃ§Ãµes crÃ­ticas

### MÃ©dia Prioridade (Testar Regularmente):

- FormulÃ¡rios
- NavegaÃ§Ã£o
- Filtros e buscas
- RelatÃ³rios

### Baixa Prioridade (Testar Ocasionalmente):

- UI/UX
- Performance
- Acessibilidade

---

## âš ï¸ Regras Importantes

1. **NUNCA** fazer deploy sem executar testes primeiro
2. **SEMPRE** revisar erros capturados
3. **SEMPRE** aplicar correÃ§Ãµes crÃ­ticas antes de deploy
4. **SEMPRE** manter testes atualizados com mudanÃ§as no cÃ³digo
5. **NUNCA** ignorar erros de teste sem investigar

---

## ğŸ” AnÃ¡lise de Erros

ApÃ³s executar testes, sempre:

1. Verificar relatÃ³rio: `test-results/fix-suggestions.json`
2. Revisar screenshots: `test-results/`
3. Assistir vÃ­deos de falhas: `test-results/`
4. Aplicar correÃ§Ãµes sugeridas
5. Re-executar testes

---

**ğŸ¯ Objetivo:** Garantir qualidade e estabilidade atravÃ©s de testes automatizados que capturam erros e sugerem correÃ§Ãµes.

